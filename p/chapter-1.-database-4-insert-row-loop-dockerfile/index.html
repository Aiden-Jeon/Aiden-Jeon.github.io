<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Github 에서 해당 내용에 대해서 확인할 수 있습니다.\nOverview 목표 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성하고 이미지를 빌드합니다. 요구사항 작성한 script를 build할 수 있는 dockerfile을 작성합니다. 작성한 dockerfile을 이용해 이미지를 build 합니다. 빌드된 이미지를 실행합니다. 이미지가 실행될 때의 host에 대해서 생각해 봅니다. psql 등을 이용해 DB에 데이터가 계속해서 쌓이고 있는지 확인합니다. Docker Dockerfile 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 FROM python:3.9-slim WORKDIR /app RUN apt-get update && apt-get install -y \\ build-essential \\ software-properties-common \\ git \\ && rm -rf /var/lib/apt/lists/* RUN pip install -U pip &&\\ pip install scikit-learn pandas psycopg2-binary COPY insert_row_loop.py insert_row_loop.py ENTRYPOINT ["python", "insert_row_loop.py"] base가 되는 이미지는 python:3.9-slim을 사용하도록 하겠습니다. 복사할 파일을 같은 곳에 묶어 두기 위해서 WORKDIR 은 /app 으로 설정합니다. 다음으로, pip install 할 수 있는 apt pacakge들을 설치합니다. 앞서 만든 스크립트에서 필요한 패키지인 scikit-learn, pandas와 psycopg2-binary 를 설치합니다. insert_row_loop.py 를 복사합니다. 이미지가 실행될 때 실행할 명령어를 입력합니다. Build Image 다음 명령어를 통해 docker 이미지를 build합니다.\n'><title>[ Chapter 1. Database ] 4) Insert Row Loop Dockerfile</title>
<link rel=canonical href=https://aiden-jeon.github.io/blog/p/chapter-1.-database-4-insert-row-loop-dockerfile/><link rel=stylesheet href=/blog/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="[ Chapter 1. Database ] 4) Insert Row Loop Dockerfile"><meta property='og:description' content='Github 에서 해당 내용에 대해서 확인할 수 있습니다.\nOverview 목표 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성하고 이미지를 빌드합니다. 요구사항 작성한 script를 build할 수 있는 dockerfile을 작성합니다. 작성한 dockerfile을 이용해 이미지를 build 합니다. 빌드된 이미지를 실행합니다. 이미지가 실행될 때의 host에 대해서 생각해 봅니다. psql 등을 이용해 DB에 데이터가 계속해서 쌓이고 있는지 확인합니다. Docker Dockerfile 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 FROM python:3.9-slim WORKDIR /app RUN apt-get update && apt-get install -y \\ build-essential \\ software-properties-common \\ git \\ && rm -rf /var/lib/apt/lists/* RUN pip install -U pip &&\\ pip install scikit-learn pandas psycopg2-binary COPY insert_row_loop.py insert_row_loop.py ENTRYPOINT ["python", "insert_row_loop.py"] base가 되는 이미지는 python:3.9-slim을 사용하도록 하겠습니다. 복사할 파일을 같은 곳에 묶어 두기 위해서 WORKDIR 은 /app 으로 설정합니다. 다음으로, pip install 할 수 있는 apt pacakge들을 설치합니다. 앞서 만든 스크립트에서 필요한 패키지인 scikit-learn, pandas와 psycopg2-binary 를 설치합니다. insert_row_loop.py 를 복사합니다. 이미지가 실행될 때 실행할 명령어를 입력합니다. Build Image 다음 명령어를 통해 docker 이미지를 build합니다.\n'><meta property='og:url' content='https://aiden-jeon.github.io/blog/p/chapter-1.-database-4-insert-row-loop-dockerfile/'><meta property='og:site_name' content="Aiden's Camp"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='postgres'><meta property='article:tag' content='docker'><meta property='article:tag' content='db'><meta property='article:published_time' content='2022-09-19T14:50:00+09:00'><meta property='article:modified_time' content='2022-09-19T14:50:00+09:00'><meta name=twitter:title content="[ Chapter 1. Database ] 4) Insert Row Loop Dockerfile"><meta name=twitter:description content='Github 에서 해당 내용에 대해서 확인할 수 있습니다.\nOverview 목표 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성하고 이미지를 빌드합니다. 요구사항 작성한 script를 build할 수 있는 dockerfile을 작성합니다. 작성한 dockerfile을 이용해 이미지를 build 합니다. 빌드된 이미지를 실행합니다. 이미지가 실행될 때의 host에 대해서 생각해 봅니다. psql 등을 이용해 DB에 데이터가 계속해서 쌓이고 있는지 확인합니다. Docker Dockerfile 앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 FROM python:3.9-slim WORKDIR /app RUN apt-get update && apt-get install -y \\ build-essential \\ software-properties-common \\ git \\ && rm -rf /var/lib/apt/lists/* RUN pip install -U pip &&\\ pip install scikit-learn pandas psycopg2-binary COPY insert_row_loop.py insert_row_loop.py ENTRYPOINT ["python", "insert_row_loop.py"] base가 되는 이미지는 python:3.9-slim을 사용하도록 하겠습니다. 복사할 파일을 같은 곳에 묶어 두기 위해서 WORKDIR 은 /app 으로 설정합니다. 다음으로, pip install 할 수 있는 apt pacakge들을 설치합니다. 앞서 만든 스크립트에서 필요한 패키지인 scikit-learn, pandas와 psycopg2-binary 를 설치합니다. insert_row_loop.py 를 복사합니다. 이미지가 실행될 때 실행할 명령어를 입력합니다. Build Image 다음 명령어를 통해 docker 이미지를 build합니다.\n'><link rel="shortcut icon" href=/blog/icons/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-419F58RW9W"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-419F58RW9W")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog/><img src=/blog/imgs/avatar_hu6933059792947527008.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🔥</span></figure><div class=site-meta><h1 class=site-name><a href=/blog>Aiden's Camp</a></h1><h2 class=site-description>Welcome to Aiden's Camp</h2></div></header><ol class=menu-social><li><a href=https://github.com/Aiden-Jeon target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/jongseob-jeon/ target=_blank title=Linkedin rel=me><svg fill="#000" height="800" width="800" id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 310 310"><g id="XMLID_801_"><path id="XMLID_802_" d="M72.16 99.73H9.927c-2.762.0-5 2.239-5 5v199.928c0 2.762 2.238 5 5 5H72.16c2.762.0 5-2.238 5-5V104.73c0-2.76100000000001-2.238-5-5-5z"/><path id="XMLID_803_" d="M41.066.341C18.422.341.0 18.743.0 41.362.0 63.991 18.422 82.4 41.066 82.4c22.626.0 41.033-18.41 41.033-41.038C82.1 18.743 63.692.341 41.066.341z"/><path id="XMLID_804_" d="M230.454 94.761c-24.995.0-43.472 10.745-54.679 22.954V104.73c0-2.761-2.238-5-5-5h-59.599c-2.762.0-5 2.239-5 5v199.928c0 2.762 2.238 5 5 5h62.097c2.762.0 5-2.238 5-5V205.74c0-33.333 9.054-46.319 32.29-46.319 25.306.0 27.317 20.818 27.317 48.034v97.204c0 2.762 2.238 5 5 5H305c2.762.0 5-2.238 5-5V194.995C310 145.43 300.549 94.761 230.454 94.761z"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/blog/categories><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/blog/tags><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/blog/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#목표>목표</a></li><li><a href=#요구사항>요구사항</a></li></ul></li><li><a href=#docker>Docker</a><ul><li><a href=#dockerfile>Dockerfile</a></li><li><a href=#build-image>Build Image</a></li><li><a href=#run-image>Run Image</a></li></ul></li><li><a href=#docker-network>Docker Network</a><ul><li><a href=#create-network>Create Network</a></li><li><a href=#connect-conatiner-to-network>Connect Conatiner to Network</a></li><li><a href=#run-docker-with-network>Run docker with network</a></li><li><a href=#docker-entrypoint>Docker Entrypoint</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/blog/categories/mle-mlops/>Mle-Mlops</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/chapter-1.-database-4-insert-row-loop-dockerfile/>[ Chapter 1. Database ] 4) Insert Row Loop Dockerfile</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 19, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p><a class=link href=https://github.com/Aiden-Jeon/mle-mlops/tree/main/01_db target=_blank rel=noopener>Github</a> 에서 해당 내용에 대해서 확인할 수 있습니다.</p><h2 id=overview><a href=#overview class=header-anchor></a>Overview</h2><h3 id=목표><a href=#%eb%aa%a9%ed%91%9c class=header-anchor></a>목표</h3><ul><li>앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성하고 이미지를 빌드합니다.</li></ul><h3 id=요구사항><a href=#%ec%9a%94%ea%b5%ac%ec%82%ac%ed%95%ad class=header-anchor></a>요구사항</h3><ol><li>작성한 script를 build할 수 있는 dockerfile을 작성합니다.</li><li>작성한 dockerfile을 이용해 이미지를 build 합니다.</li><li>빌드된 이미지를 실행합니다.<ul><li>이미지가 실행될 때의 host에 대해서 생각해 봅니다.</li></ul></li><li><code>psql</code> 등을 이용해 DB에 데이터가 계속해서 쌓이고 있는지 확인합니다.</li></ol><hr><h2 id=docker><a href=#docker class=header-anchor></a>Docker</h2><h3 id=dockerfile><a href=#dockerfile class=header-anchor></a>Dockerfile</h3><p>앞서 작성한 스크립트를 실행할 수 있는 Dockerfile을 작성합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    build-essential <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    software-properties-common <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -U pip <span class=o>&amp;&amp;</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    pip install scikit-learn pandas psycopg2-binary<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> insert_row_loop.py insert_row_loop.py<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;insert_row_loop.py&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ol><li>base가 되는 이미지는 <code>python:3.9-slim</code>을 사용하도록 하겠습니다.</li><li>복사할 파일을 같은 곳에 묶어 두기 위해서 <code>WORKDIR</code> 은 <code>/app</code> 으로 설정합니다.</li><li>다음으로, pip install 할 수 있는 apt pacakge들을 설치합니다.</li><li>앞서 만든 스크립트에서 필요한 패키지인 <code>scikit-learn</code>, <code>pandas</code>와 <code>psycopg2-binary</code> 를 설치합니다.</li><li><code>insert_row_loop.py</code> 를 복사합니다.</li><li>이미지가 실행될 때 실행할 명령어를 입력합니다.</li></ol><h3 id=build-image><a href=#build-image class=header-anchor></a>Build Image</h3><p>다음 명령어를 통해 docker 이미지를 build합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build . -t insert_row_loop
</span></span></code></pre></td></tr></table></div></div><h3 id=run-image><a href=#run-image class=header-anchor></a>Run Image</h3><p>Build된 이미지를 실행합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run insert_row_loop
</span></span></code></pre></td></tr></table></div></div><p>하지만, 위 이미지를 실행하면 다음과 같은 에러가 출력되면 실행되지 않습니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/app/insert_row_loop.py&#34;</span>, line 45, in &lt;module&gt;
</span></span><span class=line><span class=cl>    <span class=nv>db_connect</span> <span class=o>=</span> psycopg2.connect<span class=o>(</span><span class=nv>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span>, <span class=nv>database</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span>, <span class=nv>user</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span>, <span class=nv>password</span><span class=o>=</span><span class=s2>&#34;mypassword&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/usr/local/lib/python3.9/site-packages/psycopg2/__init__.py&#34;</span>, line 122, in connect
</span></span><span class=line><span class=cl>    <span class=nv>conn</span> <span class=o>=</span> _connect<span class=o>(</span>dsn, <span class=nv>connection_factory</span><span class=o>=</span>connection_factory, **kwasync<span class=o>)</span>
</span></span><span class=line><span class=cl>psycopg2.OperationalError: could not connect to server: Connection refused
</span></span><span class=line><span class=cl>	Is the server running on host <span class=s2>&#34;localhost&#34;</span> <span class=o>(</span>127.0.0.1<span class=o>)</span> and accepting
</span></span><span class=line><span class=cl>	TCP/IP connections on port 5432?
</span></span><span class=line><span class=cl>could not connect to server: Cannot assign requested address
</span></span><span class=line><span class=cl>	Is the server running on host <span class=s2>&#34;localhost&#34;</span> <span class=o>(</span>::1<span class=o>)</span> and accepting
</span></span><span class=line><span class=cl>	TCP/IP connections on port 5432?
</span></span></code></pre></td></tr></table></div></div><p>이런 이유가 나오는 이유는 도커의 네트워킹과 관련되어 있습니다.<br>기존의 스크립트를 실행할 때는 <code>localhost</code> 라는 네트워크를 공유하고 있습니다. 그래서 <code>localhost:5432</code> 로의 통신이 가능했습니다.
하지만 이미지가 실행되면 독립된 네트워크를 갖게 됩니다. 즉, 실행된 컨테이너 입장에서는 <code>localhost:5432</code>란 없는 주소입니다.<br>이를 위해서는 실행되는 두 컨테이너 사이에 네트워크를 연결시켜주어야 합니다.</p><h2 id=docker-network><a href=#docker-network class=header-anchor></a>Docker Network</h2><h3 id=create-network><a href=#create-network class=header-anchor></a>Create Network</h3><p>아래 명령어를 실행하면 현재 docker에서 사용할 수 있는 목록들이 나옵니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docekr network ls
</span></span></code></pre></td></tr></table></div></div><p>따로 설정한 적이 없다면 아래와 같이 3개의 네트워크 리스트가 나옵니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>&gt; docker network ls
</span></span><span class=line><span class=cl>NETWORK ID     NAME         DRIVER    SCOPE
</span></span><span class=line><span class=cl>b28719341e4b   bridge       bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>0d5dc37e7a9d   host         host      <span class=nb>local</span>
</span></span><span class=line><span class=cl>703a7cd222a5   none         null      <span class=nb>local</span>
</span></span></code></pre></td></tr></table></div></div><p>위 3개의 네트워크들은 도커가 실행되면 기본으로 생성되는 네트워크들입니다. 도커에서는 디폴트 네트워크를 이용하는 것 보다는 사용자가 직접 네트워크를 생성해 사용하는 것을 권장하고 있습니다.</p><p>아래 명령어를 통해 네트워크를 생성합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker network create my-network
</span></span></code></pre></td></tr></table></div></div><p>네트워크가 생성되었는지 확인해봅니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>&gt; docker network ls
</span></span><span class=line><span class=cl>NETWORK ID     NAME         DRIVER    SCOPE
</span></span><span class=line><span class=cl>b28719341e4b   bridge       bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>0d5dc37e7a9d   host         host      <span class=nb>local</span>
</span></span><span class=line><span class=cl>a6bc214efdb5   my-network   bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>703a7cd222a5   none         null      <span class=nb>local</span>
</span></span></code></pre></td></tr></table></div></div><p><code>docker network inspect &lt;NETWORK_NAME></code> 명령어를 통해 생성한 네트워크를 확인해 봅니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>&gt; docker network inspect my-network
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;my-network&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;a6bc214efdb582d2e28f25be9f7ed835767757be0f20c15659461b683829b3af&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-09-19T07:16:58.08159655Z&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;bridge&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;EnableIPv6&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;IPAM&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Config&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Subnet&#34;</span>: <span class=s2>&#34;172.22.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;172.22.0.1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Internal&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Attachable&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ingress&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigFrom&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Network&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigOnly&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Containers&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>생성한 직후에는 연결된 컨테이너가 없어서 <code>Containers</code> 가 비어있는 걸 확인할 수 있습니다.</p><h3 id=connect-conatiner-to-network><a href=#connect-conatiner-to-network class=header-anchor></a>Connect Conatiner to Network</h3><p><code>docker network connect &lt;NETWORK_NAME> &lt;CONTAINER_NAME></code> 을 이용해 기존에 실행한 DB 컨테이너를 생성한 네트워크에 연결합니다.</p><p>실행중인 db 컨테이너의 이름을 확인합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE             COMMAND                  CREATED      STATUS      PORTS                    NAMES
</span></span><span class=line><span class=cl>972d4b7e0c6e   postgres:latest   <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>3</span> days ago   Up <span class=m>3</span> days   0.0.0.0:5432-&gt;5432/tcp   db-db-1
</span></span></code></pre></td></tr></table></div></div><p>실행한 DB 컨테이너의 이름인 <code>db-db-1</code> 를 <code>my-network</code>에 연결합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker network connect my-network db-db-1
</span></span></code></pre></td></tr></table></div></div><p>연결이 되었는지 확인해 봅니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>docker network inspect my-network
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;my-network&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;a6bc214efdb582d2e28f25be9f7ed835767757be0f20c15659461b683829b3af&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-09-19T07:16:58.08159655Z&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;bridge&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;EnableIPv6&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;IPAM&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Config&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Subnet&#34;</span>: <span class=s2>&#34;172.22.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;172.22.0.1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Internal&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Attachable&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ingress&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigFrom&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Network&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigOnly&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Containers&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;972d4b7e0c6e8505ba6e8df798b35999ca8320b52777d9840bff0d86e44068e3&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;db-db-1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;054692d99556026e28d56eee40f45a839dbbdeab2bd5e853bef5618d25a86c49&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:ac:16:00:02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;172.22.0.2/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Container</code>에 <code>db-db-1이 추가된 것을 확인할 수 있습니다.</code></p><h3 id=run-docker-with-network><a href=#run-docker-with-network class=header-anchor></a>Run docker with network</h3><p>이제 데이터를 삽입하는 이미지를 실행합니다.<br><code>--network</code> 옵션을 이용해 실행하는 이미지에 네트워크를 추가할 수 있습니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network <span class=s2>&#34;my-network&#34;</span> insert_row_loop
</span></span></code></pre></td></tr></table></div></div><p>위 명령어를 실행해도 여전히 에러가 발생합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>&gt; docker run --network <span class=s2>&#34;my-network&#34;</span> insert_row_loop
</span></span><span class=line><span class=cl>Traceback <span class=o>(</span>most recent call last<span class=o>)</span>:
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/app/insert_row_loop.py&#34;</span>, line 45, in &lt;module&gt;
</span></span><span class=line><span class=cl>    <span class=nv>db_connect</span> <span class=o>=</span> psycopg2.connect<span class=o>(</span><span class=nv>host</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span>, <span class=nv>database</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span>, <span class=nv>user</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span>, <span class=nv>password</span><span class=o>=</span><span class=s2>&#34;mypassword&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  File <span class=s2>&#34;/usr/local/lib/python3.9/site-packages/psycopg2/__init__.py&#34;</span>, line 122, in connect
</span></span><span class=line><span class=cl>    <span class=nv>conn</span> <span class=o>=</span> _connect<span class=o>(</span>dsn, <span class=nv>connection_factory</span><span class=o>=</span>connection_factory, **kwasync<span class=o>)</span>
</span></span><span class=line><span class=cl>psycopg2.OperationalError: could not connect to server: Connection refused
</span></span><span class=line><span class=cl>	Is the server running on host <span class=s2>&#34;localhost&#34;</span> <span class=o>(</span>127.0.0.1<span class=o>)</span> and accepting
</span></span><span class=line><span class=cl>	TCP/IP connections on port 5432?
</span></span><span class=line><span class=cl>could not connect to server: Cannot assign requested address
</span></span><span class=line><span class=cl>	Is the server running on host <span class=s2>&#34;localhost&#34;</span> <span class=o>(</span>::1<span class=o>)</span> and accepting
</span></span><span class=line><span class=cl>	TCP/IP connections on port 5432?
</span></span></code></pre></td></tr></table></div></div><p>이는 연결된 네트워크가 <code>localhost</code>가 아닌 <code>my-network</code>로 연결되기 때문입니다.
script 파일에서 db 연결을 위한 host 부분을 아래와 같이 수정합니다.
이 때 사용하는 host 이름은 연결하려는 컨테이너의 이름입니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>db_connect</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;my-network&#34;</span><span class=p>,</span> <span class=n>database</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s2>&#34;mypassword&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>다시 이미지를 빌드하고 실행합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build . -t insert_row_loop
</span></span><span class=line><span class=cl>docker run --network <span class=s2>&#34;my-network&#34;</span> insert_row_loop
</span></span></code></pre></td></tr></table></div></div><p><em><strong>주의</strong>: m1 맥북은 <code>--platform=linux/amd64</code> 를 입력해야 정성작으로 실행됩니다.</em></p><p>이제 제대로 실행되는 것을 확인할 수 있습니다. <code>psql</code> 명령어를 이용해 계속해서 데이터가 들어오고 있는지 확인해 봅니다.</p><p>또한 network도 제대로 연결되었는지 확인해봅니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>&gt; docker network inspect my-network
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;my-network&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;a6bc214efdb582d2e28f25be9f7ed835767757be0f20c15659461b683829b3af&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-09-19T07:16:58.08159655Z&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;bridge&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;EnableIPv6&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;IPAM&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Config&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Subnet&#34;</span>: <span class=s2>&#34;172.22.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;172.22.0.1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Internal&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Attachable&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ingress&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigFrom&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Network&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigOnly&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Containers&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;490a5ae2948f82caf6df7d5147e83763b600629701de905dcb8eb732ed737ce9&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;vigorous_mirzakhani&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;fdec99903513900ae49864079da5d2fb3cb3c09d031a4880cefc2c551a586c1a&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:ac:16:00:03&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;172.22.0.3/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;972d4b7e0c6e8505ba6e8df798b35999ca8320b52777d9840bff0d86e44068e3&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;db-db-1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;054692d99556026e28d56eee40f45a839dbbdeab2bd5e853bef5618d25a86c49&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:ac:16:00:02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;172.22.0.2/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>container가 두개로 늘어난 것을 확인할 수 있습니다.</p><h3 id=docker-entrypoint><a href=#docker-entrypoint class=header-anchor></a>Docker Entrypoint</h3><p>그런데 db 컨테이너의 이름이 변경이 될 때 마다 docker 를 매번 빌드할 수 없으므로 이를 argument로 받아서 실행될 수 있게 변경해 보겠습니다.</p><p>우선 파이썬 스크립트에서 다음과 같이 argument를 받을 수 있게 수정합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>argparse</span> <span class=kn>import</span> <span class=n>ArgumentParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>ArgumentParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--host&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>db_connect</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>host</span><span class=p>,</span> <span class=n>database</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span><span class=p>,</span> <span class=n>user</span><span class=o>=</span><span class=s2>&#34;postgres&#34;</span><span class=p>,</span> <span class=n>password</span><span class=o>=</span><span class=s2>&#34;mypassword&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>get_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>insert_row_loop</span><span class=p>(</span><span class=n>db_connect</span><span class=p>,</span> <span class=n>df</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>도커 파일에서 argument를 받을 수 있도록 수정합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    build-essential <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    software-properties-common <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -U pip <span class=o>&amp;&amp;</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    pip install psycopg2-binary scikit-learn pandas<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> insert_row_loop.py insert_row_loop.py<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;insert_row_loop.py&#34;</span><span class=p>,</span> <span class=s2>&#34;--host&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>새로운 이미지를 빌드하고 실행합니다. 이 때 argument로 db 컨테이너의 이름을 입력합니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build . -t insert_row_loop
</span></span><span class=line><span class=cl>docker run --network <span class=s2>&#34;my-network&#34;</span> insert_row_loop <span class=s2>&#34;db-db-1&#34;</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/blog/tags/postgres/>Postgres</a>
<a href=/blog/tags/docker/>Docker</a>
<a href=/blog/tags/db/>Db</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/blog/p/chapter-1.-database-2-create-table-and-insert-row/><div class=article-details><h2 class=article-title>[ Chapter 1. Database ] 2) Create Table and Insert Row</h2></div></a></article><article><a href=/blog/p/chapter-1.-database-1-run-postgresql-server/><div class=article-details><h2 class=article-title>[ Chapter 1. Database ] 1) Run Postgresql Server</h2></div></a></article><article><a href=/blog/p/chapter-1.-database-3-insert-row-loop/><div class=article-details><h2 class=article-title>[ Chapter 1. Database ] 3) Insert Row Loop</h2></div></a></article><article><a href=/blog/p/chapter-4.-model-api-4-docker-without-model/><div class=article-details><h2 class=article-title>[ Chapter 4. Model API ] 4) Docker without model</h2></div></a></article><article><a href=/blog/p/chapter-4.-model-api-3-docker-with-model/><div class=article-details><h2 class=article-title>[ Chapter 4. Model API ] 3) Docker with model</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=aiden-jeon/aiden-jeon.github.io issue-term=pathname label=comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Aiden's Camp</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>